# ELB(Elastic Load Balancer)
- AWS에서 제공하는 관리형 로드밸런서 서비스
- 둘 이상의 가용 영역에서 EC2 인스턴스, 컨테이너, IP주소 등 여러 대상에 걸쳐 수신되는 트래픽을 자동으로 분산하여 애플리케이션의 가용성과 확장성을 향상시키는데 사용

### 📌 작동 방식
---
- 클라이언트에서 오는 트래픽을 허용하고, 하나 이상의 가용영역에서 등록된 대상`ex. EC2 인스턴스`으로 요청을 라우팅
- 등록된 대상의 상태를 모니터링하고 정상 대상으로만 트래픽이 라우팅되도록 함
- 로드 밸런서가 비정상 대상을 감지하면, 해당 대상으로의 트래픽 라우팅 중단
	-> 대상이 다시 정상으로 감지되면 트래픽을 해당 대상으로 다시 라우팅
- 하나 이상의 리스너를 지정하여 들어오는 트래픽을 허용하도록 로드 밸런서 구성
	`리스너: 연결 요청을 확인하는 프로세스로, 클라이언트와 로드 밸런서 또는 로드 밸런서와 대상 간의 연결을 위한 프로토콜 및 포트번호로 구성. `

- 대상을 대상 그룹에 등록하고 트래픽을 대상 그룹에 라우팅하는 유형
	\- ALB(Application Load Balancer)
	\- NLB(Network Load Balancer)
	\- GLB(Gateway Load Balancer)
- 로드밸런서에 인스턴스를 등록하는 유형
	\- CLB(Classic Load Balancer)

##### 🏷️ 라우팅 알고리즘
- ALB
	1. 적용할 규칙을 결정하기 위해 우선 순위에 따라 리스너 규칙을 평가
	2. 대상 그룹에 대해 구성된 라우팅 알고리즘`(default: 라운드 로빈 방식)`을 사용하여 규칙 조치에 대한 대상 그룹에서 대상을 선택(대상이 여러 개의 대상 그룹에 등록이 된 경우에도 각 대상 그룹에 대해 독립적으로 라우팅이 수행됨)

- NLB
	1. 흐름 해시 알고리즘을 사용해 기본 규칙에 대한 대상 그룹에서 대상 선택
		`알고리즘은 프로토콜, 소스 IP 주소 및 소스 포트, 대상 IP 주소 및 대상 포트, TCP 시퀀스 번호를 기반으로 함`
	2. 각 개별 TCP연결은 연결 수명 동안 하나의 대상에 라우팅됨. 클라이언트로부터의 TCP 연결은 소스 포트와 시퀀스 번호가 서로 다르므로 다른 대상에 라우팅될 수 있음.

- CLB
	1. TCP 리스너에 대한 라운드 로빈 라우팅 알고리즘 사용
	2. HTTP 및 HTTPS 리스너에 대한 최소 미해결 요청 라우팅 알고리즘 사용

### 📌 유형
---
##### 🏷️ ALB(Application Load Balancer)
- Layer 7(Application Layer)에서 동작하는 로드 밸런서 서비스

![](https://i.imgur.com/PKPjyKS.png)

- 구성요소
	1. 로드 밸런서
		\- 클라이언트에 대한 단일 접점 역할을 수행
		\- 여러 가용 영역에서 EC2 인스턴스 같은 여러 대상에 수신 애플리케이션 트래픽을 분산 
			-> 애플리케이션 가용성 향상
		\- 하나 이상의 리스너 추가 가능
	2. 리스너
		\- 구성한 프로토콜 및 포트를 사용해 클라이언트의 연결 요청을 확인
		\- 리스너에 대해 정의한 규칙에 따라 로드 밸런서가 등록된 대상으로 요청을 라우팅하는 방법이 결정되며 조건 충족시 작업 수행 `(각 규칙은 우선 순위, 하나 이상의 작업, 하나 이상의 조건으로 구성)`
		\- 각 리스너에 대한 기본 규칙을 정의해야하며, 필요에 따라 추가 규칙 정의 가능
	3. 대상 그룹
		\- 지정한 프로토콜과 포트 번호를 사용해 EC2 인스턴스 같은 하나 이상의 등록된 대상으로 요청을 라우팅
		\- 여러 대상 그룹에 대상을 등록할 수 있으며, 대상 그룹 기준으로 상태 확인 구성 가능
		\- 로드 밸런서의 리스너 규칙에서 지정한 대상 그룹에 등록된 모든 대상에서 상태 검사가 수행됨

- 주요 특징과 기능
	1. HTTP 및 HTTPS 트래픽 지원
		\- HTTP/1.1, HTTP/2, WebSocket 프로토콜을 지원하며, HTTPS 트래픽을 암호화하여 보호 가능
	2. 경로 기반 라우팅
		\- 들어오는 요청의 경로(Path)를 기반으로 서로 다른 대상 그룹(Target Group)으로 트래픽을 라우팅할 수 있음
		\- 이를 통해 여러 서비스를 단일 ALB로 효율적으로 관리하고 분리된 엔드포인트로 라우팅
	3. 도메인 기반 라우팅
		\- 호스트 헤더(Host Header)를 기반으로 요청을 다른 대상 그룹으로 라우팅할 수 있는 기능 제공
		\- 다중 도메인을 사용하는 경우 여러 도메인을 하나의 ALB에서 관리할 수 있게함
	4. 컨테이너화된 응용 프로그램 지원
		\- Amazon ECS(Elastic Container Service) 및 Amazon EKS(Elastic Kubernetes Service)와 함계 사용하여 컨테이너화된 응용 프로그램의 로드 밸런싱을 지원
	5. TLS 오프로딩
		\- SSL/TLS 암호화 및 해독을 앞단에서 처리하여 백엔드 서비스의 부담 감소
		\- 서버 성능을 최적화하고, SSL/TLS 연결 처리 속도를 높이는 데 도움
	6. 상태 검사 및 Health Check
		\- 대상 그룹에 속한 인스턴스나 컨테이너의 상태를 정기적으로 검사하여 건강한 인스턴스로만 트래픽을 전송하고, 비정상적인 인스턴스는 자동으로 거부함
	7. 로그 및 모니터링
		\- 트래픽 로그를 Amazon S3에 저장하고, Amazon CloudWatch Logs에 로깅할 수 있는 기능을 제공해 실시간 모니터링 및 분석 지원

##### 🏷️ NLB(Network Load Balancer)
- Layer 4(전송 계층)에서 동작하는 로드 밸런서로, TCP와 UDP 트래픽을 효과적으로 분산시키는데 중점을 두고 설계된 서비스

- 구성요소
	1. 로드 밸런서
		\- 클라이언트에 대한 단일 접점 역할 수행
		\- 수신 트래픽을 Amazon EC2 인스턴스와 같은 여러 대상에 분산 
			-> 애플리케이션 가용성 향상
		\- 하나 이상의 리스너 추가 가능
	2. 리스너
		\- 사용자가 구성한 프로토콜과 포트를 사용해 클라이언트의 연결 요청을 확인하고, 요청을 대상 그룹으로 전달
	3. 대상 그룹
		\- 지정한 프로토콜과 포트 번호를 사용해 EC2 인스턴스같은 하나 이상의 등록된 대상으로 요청을 라우팅
		\- TCP, UDP, TCP_UDP 및 TLS 프로토콜 지원
		\- 여러 대상 그룹에 대상 등록가능
		\- 대상 그룹기준으로 상태 확인을 구성할 수 있으며, 로드 밸런서의 리스너 규칙에서 지정한 대상 그룹에 등록된 모든 대상에서 상태 검사 수행

- 주요 특징과 기능
	1. TCP/UDP 트래픽 지원
		\- TCP 및 UDP 프로토콜을 지원하며, 특히 대량의 트래픽을 처리하는데 적합함
		\- 데이터베이스, 게임 서버, IoT 애플리케이션 등 다양한 용도에 사용됨
	2. 초당 수백만 요청 처리
		\- 높은 성능을 제공하여 초당 수백만 개의 요청 처리 가능
		\- 이를 통해 대규모 트래픽을 효과적으로 관리
	3. 고정 IP 주소
		\- 각 로드 밸런서에 대해 고정 IP 주소를 제공하며, 탄력적 IP(Elastic IP)를 할당하여 IP 주소 고정 가능
		\- IP 주소 기반의 방화벽 규칙이나 네트워크 설계에서 유리할 수 있음
	4. 스케일링 및 가용성
		\- 자동으로 트래픽의 양에 따라 확장/축소할 수 있으며, 여러 가용 영역에 걸쳐 배포되어 고가용성을 보장
	5. 세션 유지
		\- 세션 유지(Session Stickiness) 기능을 지원하여, 특정 클라이언트의 요청을 항상 동일한 서버로 전달 가능.
		\- 상태를 유지해야하는 애플리케이션에 유용
	6. Health Check
		\- 대상 그룹에 속한 인스턴스의 상태를 정기적으로 검사하여, 비정상적인 인스턴스는 자동으로 로드 밸런싱에서 제외
	7. TLS 종료
		\- TLS 종료를 지원하여, 암호화된 트래픽을 로드 밸런서에서 해독하고 내부 트래픽은 평문으로 처리
		\- NLB의 성능을 높이고 서버의 부담을 줄이는 데 도움
	8. Amazon Route 53과 통합
		\- Amazon Route 53과 통합되어 DNS 기반의 라우팅을 통해 지리적 위치 또는 기타 기준에 따라 트래픽 분산 가능


##### 🏷️ CLB(Classic Load Balancer)
- ELB 서비스의 초기 로드 밸런서 유형으로, 다양한 애플리케이션에 대한 기본적인 로드 밸런식 기능을 제공
- Layer 4(전송 계층) 및 Layer 7(애플리케이션 계층)에서 작동하며, HTTP/HTTPS 및 TCP 트래픽 처리 가능

- 구성 요소
	1. 로드 밸런서
		\- 클라이언트의 요청을 수신하고 등록된 EC2 인스턴스에 대해 트래픽을 분산
		\- 애플리케이션의 앞단에서 트래픽을 수신하여, 적절한 EC2 인스턴스에 요청을 전달
		\- HTTP/HTTPS 및 TCP 트래픽 처리
		\- 클라이언트와 서버 간의 중계 역할
	2. 리스너
		\- 클라이언트의 요청을 수신하고, 해당 요청을 등록된 인스턴스로 전달하는 규칙 설정
		\- 요청 받을 포트와 프로토콜을 정의함
	3. 대상 그룹
		\- 트래픽을 분산할 대상 EC2 인스턴스의 집합으로, 각 대상 그룹은 하나 이상의 EC2 인스턴스로 구성됨
		\- 클라이언트의 요청은 이 대상 그룹에 속한 인스턴스들 사이에 분산됨
		\- 각 인스턴스의 상태를 모니터링하고, 정상 상태인 인스턴스에만 트래픽을 전달

- 주요 기능
	1. 트래픽 분산
		\- **HTTP/HTTPS**: 
			HTTP 및 HTTPS 트래픽을 EC2 인스턴스에 분산하여 웹 애플리케이션의 부하를 조절
			요청은 로드 밸런서가 균등하게 분산하여 인스턴스의 부하를 평준화함
		\- **TCP**: TCP 트래픽을 기반으로 하는 애플리케이션에 대해 TCP 연결을 관리하고 트래픽을 분산
	2. 단순한 라우팅
		\- 요청을 수신하고 이를 등록된 EC2 인스턴스로 전달
		\- 요청은 라운드로빈 방식으로 분산되며, 간단한 라우팅 기능을 제공
	3. Health Check
		\- 등록된 인스턴스의 상태를 정기적으로 확인하여, 비정상 인스턴스에 대한 트래픽을 자동으로 제외시킴
			-> 애플리케이션의 가용성 유지
	4. 스케일링
		\- 트래픽의 변화에 따라 자동으로 확장/축소 가능
		\- 사용자가 로드 밸런서 설정시, EC2 인스턴스의 수를 변경하지 않고도 로드 밸런서 조정 가능
	5. SSL/TLS 지원
		\- SSL/TLS 암호화를 지원하여 보안 연결을 제공
		\- 클라이언트와 로드 밸런서 간의 트래픽은 암호화되며, 클라이언트와 서버 간의 데이터 보안이 강화됨
	6. 기본적인 세션 유지
		\- 세션 유지 기능을 제공하여, 클라이언트가 동일한 서버와 계속 상호작용할 수 있도록 함
			-> 애플리케이션의 상태를 유지하는데 유용

- 장점
	\- 간단한 로드 밸런싱 요구 사항을 충족하는데 적합
	\- 복잡한 라우팅 요구가 없는 애플리케이션에 적합
	\- 설정과 사용이 간단하여 기본적인 로드 밸런싱 기능을 제공하고 빠르게 배포 가능

- 단점
	\- ALB와 NLB에서 제공하는 고급 기능`(ex. 경로 기반 라우팅, 호스트 기반 라우팅, UDP 트래픽지원 등)`을 지원하지 않음
	\- 최신 AWS 로드 밸런서 기능을 포함하지 않으며, 보다 고급 기능이 필요한 경우 ALB나 NLB를 사용하는것이 좋음
